// src/component/exams/ExamCard.tsx
import { CCard, CCardBody, CBadge, CButton } from "@coreui/react";
import CIcon from "@coreui/icons-react";
import {
  cilLibrary,
  cilLocationPin,
  cilCalendar,
  cilAlarm,
} from "@coreui/icons";
import { formatDateTime, formatDateOnly } from "../../utils/dateFormatting";

// ako imaš već ExamDTO – slobodno zamijeni any sa njim
type ExamCardProps = {
  exam: {
    id: number;
    courseName: string;
    courseCode: string;
    examDate: string;
    regDeadline: string;
    location: string;
  };
  isRegistered?: boolean;
  loading?: boolean;
  onRegister?: (id: number) => void;
  onUnregister?: (id: number) => void;
};

export function ExamCard({
  exam,
  isRegistered = false,
  loading = false,
  onRegister,
  onUnregister,
}: ExamCardProps) {
  const examDate = formatDateTime(exam.examDate);
  const regDeadline = formatDateOnly(exam.regDeadline);

  const handleClick = () => {
    if (loading) return;
    if (isRegistered && onUnregister) {
      onUnregister(exam.id);
    } else if (!isRegistered && onRegister) {
      onRegister(exam.id);
    }
  };

  const buttonLabel = loading
    ? isRegistered
      ? "Unregistering..."
      : "Registering..."
    : isRegistered
    ? "Unregister"
    : "Register";

  return (
    <CCard
      className="ui-surface-glass-card"
      style={{
        borderRadius: 28,
        padding: 28,
        minHeight: 260,
        display: "flex",
        flexDirection: "column",
        justifyContent: "space-between",
        background:
          "linear-gradient(135deg, rgba(33,37,63,0.92), rgba(7,9,18,0.95))",
        backdropFilter: "blur(22px)",
        border: "1px solid rgba(255,255,255,0.16)",
        color: "#E7ECF5",
      }}
    >
      <CCardBody style={{ padding: 0, display: "flex", flexDirection: "column", gap: 18 }}>

        {/* HEADER ROW: badges + status */}
        <div className="d-flex justify-content-between align-items-center mb-2">
          <div className="d-flex gap-2">
            <CBadge className="ui-badge ui-badge-primary d-flex align-items-center gap-1">
              <CIcon icon={cilLibrary} size="sm" /> {exam.courseCode}
            </CBadge>

            <CBadge className="ui-badge ui-badge-soft d-flex align-items-center gap-1">
              <CIcon icon={cilLocationPin} size="sm" /> {exam.location}
            </CBadge>
          </div>

          {isRegistered && (
            <span className="ui-badge ui-badge-status">Registered</span>
          )}
        </div>

        {/* TITLE */}
        <h3
          style={{
            fontSize: 22,
            fontWeight: 700,
            margin: 0,
            color: "#FFFFFF",
            minHeight: 52,
          }}
        >
          {exam.courseName}
        </h3>

        {/* INFO BLOCK */}
        <div
          className="d-flex flex-column gap-2"
          style={{ fontSize: 15, color: "#b6c0d1" }}
        >
          <div className="ui-info-pill">
            <CIcon icon={cilCalendar} size="sm" className="ui-info-icon" />
            <span>{examDate}</span>
          </div>

          <div className="ui-info-pill">
            <CIcon icon={cilAlarm} size="sm" className="ui-info-icon" />
            <span>Deadline: {regDeadline}</span>
          </div>
        </div>

        {/* ACTION ROW */}
        <div
          className="d-flex justify-content-end"
          style={{ marginTop: 14 }}
        >
          <CButton
            className={`ui-button-cta ${
              isRegistered ? "ui-button-cta-danger" : ""
            }`}
            style={{
              minWidth: 150,
              paddingInline: 20,
            }}
            disabled={loading}
            onClick={handleClick}
          >
            {buttonLabel.toUpperCase()}
          </CButton>
        </div>
      </CCardBody>
    </CCard>
  );
}
